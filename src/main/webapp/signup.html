<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>SIGN UP</title>
    <link rel="stylesheet" href="css/login.css">
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
    <script src="js/common.js"></script>
</head>
<body>
    <div class="wrapper">
        <div class="container" style="padding: 40px 0">
            <h1>注册</h1>
            <form class="form">
                <input type="email" id="email" placeholder="E-mail">
                <input type="text" id="username" placeholder="Username">
                <input type="password" id="password" placeholder="Password">
                <input type="password" id="confirm-pw" placeholder="Confirm Password">
                <button type="submit" id="signup-button">Sign Up</button>
            </form>
            <span>已有账号？立即</span>
            <a href="login.html">登录</a>
        </div>

        <ul class="bg-bubbles">
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
        </ul>
    </div>

</body>
<script>
    const email = $("#email");
    const username = $('#username');
    const password = $("#password");
    const confirm_pw = $("#confirm-pw");

    email.blur(function () {
        console.log(email.val());
        console.log(password.val());
        console.log(confirm_pw.val());

        const pattern = /^([A-Za-z0-9_\-.])+@([A-Za-z0-9_\-.])+\.([A-Za-z]{2,8})$/;
        if (email.val() !== "") {
            if (!pattern.test(this.value)) {
                email.addClass("invalid-display");
            } else {
                email.removeClass("invalid-display");
            }
        }
    });

    password.blur(function () {
        if (password.val() !== "" && confirm_pw.val() !== "") {
            if (confirm_pw.val() !== password.val()) {
                console.log("1");
                password.addClass("invalid-display");
                confirm_pw.addClass("invalid-display");
            } else {
                console.log("2");
                password.removeClass("invalid-display");
                confirm_pw.removeClass("invalid-display");
            }
        }
    });

    confirm_pw.focus(function () {
        if (password.val() === "") {
            console.log("3");
            password.addClass("invalid-display");
        } else {
            console.log("4");
            password.removeClass("invalid-display");
        }
    });

    confirm_pw.blur(function () {
        if (confirm_pw.val() !== "") {
            if (confirm_pw.val() !== password.val()) {
                console.log("5");
                password.addClass("invalid-display");
                confirm_pw.addClass("invalid-display");
            } else {
                console.log("6");
                password.removeClass("invalid-display");
                confirm_pw.removeClass("invalid-display");
            }
        }
    });

    $("#signup-button").click(function (event) {
        event.preventDefault();

        if (email.val() === "" || username.val() === "" || password.val() === "" || confirm_pw.val() === "") {
            alert("请填写完整");
        }
        else {
            $.ajax({
                url: 'http://localhost:8080/brpg/lalala',
                type: 'POST',
                data: {
                    method: "login",
                    userId: email.val(),
                    password: password.val()
                },
                timeout: 3000,
                dataType: 'json',
                success: function (data) {  //成功执行方法
                    console.log(data);
                    alert(data);
                    if (data === 1) {
                        $('form, span, a').fadeOut(500);
                        $('.wrapper').addClass('form-success-signup');
                        $('.form-success-signup h1').text("注册成功！" + username.val());
                    }
                }
            });

        }


    });
</script>
</html>
